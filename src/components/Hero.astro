---
import { marked } from 'marked';
import type { Hero as HeroProps } from '../types';
import Button from './Button.astro';
import CustomImage from './CustomImage.astro';

type Props = HeroProps;

const { title, image, text, actions, avatar, pageAvatar } = Astro.props;
---

{
    (title || image?.src || text || (actions && actions.length > 0) || avatar) && (
        <section class="mb-16 w-full sm:mb-24">
            <div class="flex flex-col items-start gap-8 md:flex-row md:items-start">
                <div class="w-full md:w-1/4 flex-shrink-0">
                    {avatar?.src && (
                        <div class="w-full overflow-hidden rounded-md" style="aspect-ratio: 4 / 5;">
                            <CustomImage
                                class="w-full h-full object-cover"
                                src={avatar.src}
                                alt={avatar.alt || 'Photo'}
                                widths={[240, 320, 480, 640]}
                                sizes="(min-width: 768px) 25vw, 50vw"
                                fetchpriority="high"
                                loading="eager"
                            />
                        </div>
                    )}
                </div>

                <div class="w-full md:w-3/4">
                    {title && <h1 class="font-serif text-3xl leading-tight font-medium sm:text-5xl sm:leading-tight">{title}</h1>}
                    {image?.src && (
                        <figure>
                            <CustomImage
                                class="w-full"
                                {...image}
                                widths={[480, 640, 768, 1024, 1536]}
                                sizes="(min-width: 832px) 768px, calc(100vw - 32px)"
                                fetchpriority="high"
                                loading="eager"
                            />
                            {image.caption && <figcaption class="mt-1.5 text-xs sm:text-sm">{image.caption}</figcaption>}
                        </figure>
                    )}
                    {text && (
                        <div class="prose sm:prose-lg max-w-none">
                            <div class="flex items-start gap-4">
                                {pageAvatar?.src && (
                                    <div class="flex-shrink-0">
                                        <CustomImage
                                            class="w-10 h-10 rounded-full object-cover"
                                            src={pageAvatar.src}
                                            alt={pageAvatar.alt || 'Avatar'}
                                            widths={[40, 80, 160]}
                                            sizes="40px"
                                            loading="eager"
                                        />
                                    </div>
                                )}
                                <div class="min-w-0" set:html={marked.parse(text)} />
                            </div>
                        </div>
                    )}
                    {actions && actions.length > 0 && (
                        <div class="flex flex-wrap gap-4 mt-4">
                            {actions.map((action) => (
                                <Button href={action.href}>{action.text}</Button>
                            ))}
                        </div>
                    )}
                </div>
            </div>
        </section>
    )
}
