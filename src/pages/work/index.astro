---
import { getCollection } from 'astro:content';
import WorkPublicationCard from '../../components/WorkPublicationCard.astro';
import BaseLayout from '../../layouts/BaseLayout.astro';

const allWork = (await getCollection('work')).sort((a, b) => {
    const dateA = a.data.publishDate ? new Date(a.data.publishDate).getTime() : 0;
    const dateB = b.data.publishDate ? new Date(b.data.publishDate).getTime() : 0;
    return dateB - dateA;
});

const webCopyWork = allWork.filter((item) => item.data.category === 'web-copy');
const journalismWork = allWork.filter((item) => item.data.category === 'journalism');

// Group work items by publication/client
const groupByPublication = (items: typeof allWork, isJournalism: boolean) => {
    const grouped = new Map<string, typeof items>();
    
    items.forEach((item) => {
        const key = isJournalism ? (item.data.publication || item.data.title) : (item.data.client || item.data.title);
        if (!grouped.has(key)) {
            grouped.set(key, []);
        }
        grouped.get(key)!.push(item);
    });
    
    return Array.from(grouped.entries()).map(([name, items]) => ({
        name,
        items: items.sort((a, b) => {
            const dateA = a.data.publishDate ? new Date(a.data.publishDate).getTime() : 0;
            const dateB = b.data.publishDate ? new Date(b.data.publishDate).getTime() : 0;
            return dateB - dateA;
        })
    }));
};

const journalismByPublication = groupByPublication(journalismWork, true);
const webCopyByClient = groupByPublication(webCopyWork, false);
---

<BaseLayout title="Work" description="Explore my professional work across web copy, journalism, and more" showHeader={false}>
    <h1 class="mb-8 font-serif text-2xl leading-tight italic sm:mb-12 sm:text-4xl">Work</h1>
    <p class="mb-12 leading-relaxed sm:mb-16 sm:text-lg">
        Discover my professional work across writing, content creation, and journalism.
    </p>

    <!-- Tag Navigation -->
    <nav class="mb-12 flex flex-wrap gap-6 sm:mb-16 lg:gap-8" aria-label="Work section navigation">
        <a
            href="#journalism"
            class="tag-link font-serif text-lg italic hover:underline hover:decoration-2 hover:underline-offset-4 transition-all sm:text-xl"
            data-section="journalism"
        >
            Journalism
        </a>
        <a
            href="#web-copy"
            class="tag-link font-serif text-lg italic hover:underline hover:decoration-2 hover:underline-offset-4 transition-all sm:text-xl"
            data-section="web-copy"
        >
            Web Copy & Content
        </a>
    </nav>

    <!-- Journalism Section -->
    <section id="journalism" class="mb-20 scroll-mt-24 sm:mb-32 md:scroll-mt-32">
        <h2 class="mb-4 font-serif text-xl italic sm:text-2xl">Journalism</h2>
        <p class="mb-12 leading-relaxed text-gray-700 dark:text-gray-300">
            I contribute regularly to leading publications, covering topics from culture and lifestyle to technology and business.
        </p>
        <div class="space-y-0">
            {journalismByPublication.length > 0 ? (
                journalismByPublication.map((group) => (
                    <WorkPublicationCard
                        publicationName={group.name}
                        articles={group.items.map((item) => ({
                            id: item.id,
                            title: item.data.title,
                            description: item.data.description,
                            publishDate: item.data.publishDate
                        }))}
                    />
                ))
            ) : (
                <p class="text-center italic text-gray-600 dark:text-gray-400">No journalism projects yet.</p>
            )}
        </div>
    </section>

    <!-- Web Copy & Content Section -->
    <section id="web-copy" class="scroll-mt-24 md:scroll-mt-32">
        <h2 class="mb-4 font-serif text-xl italic sm:text-2xl">Web Copy & Content</h2>
        <p class="mb-12 leading-relaxed text-gray-700 dark:text-gray-300">
            I create compelling web copy, product documentation, and marketing content that communicates value and engages audiences.
        </p>
        <div class="space-y-0">
            {webCopyByClient.length > 0 ? (
                webCopyByClient.map((group) => (
                    <WorkPublicationCard
                        publicationName={group.name}
                        articles={group.items.map((item) => ({
                            id: item.id,
                            title: item.data.title,
                            description: item.data.description,
                            publishDate: item.data.publishDate
                        }))}
                    />
                ))
            ) : (
                <p class="text-center italic text-gray-600 dark:text-gray-400">No web copy projects yet.</p>
            )}
        </div>
    </section>
</BaseLayout>

<style>
    @reference "tailwindcss";

    .tag-link {
        position: relative;
        display: inline-block;
        text-decoration: none;
        border-bottom: 2px solid transparent;
        transition: border-color 0.3s ease;
    }

    .tag-link:hover {
        border-bottom-color: currentColor;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const tagLinks = document.querySelectorAll('.tag-link');
        
        tagLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionId = link.getAttribute('data-section');
                const section = document.getElementById(sectionId);
                
                if (section) {
                    section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
    });
</script>
